{"version":3,"sources":["../src/histogram_tooltip.js"],"names":[],"mappings":"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","file":"histogram_tooltip.js","sourcesContent":["import $ from 'jquery';\n\nexport default function HistogramTooltip(elem, dashboard, scope, getSeriesFn) {\n  var self = this;\n  var ctrl = scope.ctrl;\n  var panel = ctrl.panel;\n\n  var $tooltip = $('<div id=\"tooltip\" class=\"graph-tooltip\">');\n\n  this.findHoverIndexFromDataPoints = function(posX, series, last) {\n    var ps = series.datapoints.pointsize;\n    var initial = last*ps;\n    var len = series.datapoints.points.length;\n    for (var j = initial; j < len; j += ps) {\n      if (series.datapoints.points[j] > posX) {\n        return Math.max(j - ps,  0)/ps;\n      }\n    }\n    return j/ps - 1;\n  };\n\n    this.findHoverIndexFromData = function(posX, series) {\n      var prev = 0;\n      var len = series.data.length;\n      for (var j = 0; j < len; j++) {\n        var rem;\n        var zeroFix = 1;\n        if (posX < 0) {\n            zeroFix = -1;\n        }\n        rem = (posX + zeroFix) % parseInt(posX + zeroFix, 10);\n\n        if (series.data[j][0] > posX) {\n          if (rem < 0.5) {\n            return Math.max(j - 1,  0);\n          } else if (panel.centeredbars || panel.orderedbars) {\n            return Math.max(j,  0);\n          } else {\n            return Math.max(j - 1,  0);\n          }\n        }\n      }\n      return j - 1;\n    };\n\n  this.showTooltip = function(title, innerHtml, pos) {\n    var body = '<div class=\"graph-tooltip-time\">'+ title + '</div>';\n    body += innerHtml + '</div>';\n    $tooltip.html(body).place_tt(pos.pageX + 20, pos.pageY);\n  };\n\n  this.getMultiSeriesPlotHoverInfo = function(seriesList, pos) {\n    var value, i, series, hoverIndex;\n    var results = [];\n\n    //now we know the current X (j) position for X and Y values\n    var last_value = 0; //needed for stacked values\n\n    for (i = 0; i < seriesList.length; i++) {\n      series = seriesList[i];\n\n      if (!series.data.length || (panel.legend.hideEmpty && series.allIsNull)) {\n        results.push({ hidden: true });\n        continue;\n      }\n\n      if (!series.data.length || (panel.legend.hideZero && series.allIsZero)) {\n        results.push({ hidden: true });\n        continue;\n      }\n\n      hoverIndex = this.findHoverIndexFromData(pos.x, series);\n      results.time = series.data[hoverIndex][0];\n\n      if (series.stack) {\n        if (panel.tooltip.value_type === 'individual') {\n          value = series.data[hoverIndex][1];\n        } else if (!series.stack) {\n          value = series.data[hoverIndex][1];\n        } else {\n          last_value += series.data[hoverIndex][1];\n          value = last_value;\n        }\n      } else {\n        value = series.data[hoverIndex][1];\n      }\n\n      // Highlighting multiple Points depending on the plot type\n      if (series.lines.steps || series.stack) {\n        // stacked and steppedLine plots can have series with different length.\n        // Stacked series can increase its length on each new stacked serie if null points found,\n        // to speed the index search we begin always on the last found hoverIndex.\n        var newhoverIndex = this.findHoverIndexFromDataPoints(pos.x, series, hoverIndex);\n        results.push({ value: value, hoverIndex: newhoverIndex });\n      } else {\n        results.push({ value: value, hoverIndex: hoverIndex });\n      }\n    }\n\n    return results;\n  };\n\n  elem.mouseleave(function () {\n    if (panel.tooltip.shared) {\n      var plot = elem.data().plot;\n      if (plot) {\n        $tooltip.detach();\n        plot.unhighlight();\n      }\n    }\n\n    if (dashboard.sharedCrosshair) {\n      ctrl.publishAppEvent('clearCrosshair');\n    }\n  });\n\n  elem.bind(\"plothover\", function (event, pos, item) {\n    var plot = elem.data().plot;\n    var plotData = plot.getData();\n    var seriesList = getSeriesFn();\n    var group, value, hoverInfo, i, series, seriesHtml, tooltipFormat;\n\n    if (panel.tooltip.msResolution) {\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss.SSS';\n    } else {\n      tooltipFormat = 'YYYY-MM-DD HH:mm:ss';\n    }\n\n    if (dashboard.sharedCrosshair) {\n      ctrl.publishAppEvent('setCrosshair', { pos: pos, scope: scope });\n    }\n\n    if (seriesList.length === 0) {\n      return;\n    }\n\n    if (panel.tooltip.shared) {\n      plot.unhighlight();\n\n      var seriesHoverInfo = self.getMultiSeriesPlotHoverInfo(plotData, pos);\n\n      seriesHtml = '';\n\n      for (i = 0; i < seriesHoverInfo.length; i++) {\n        hoverInfo = seriesHoverInfo[i];\n\n        if (hoverInfo.hidden) {\n          continue;\n        }\n\n        var highlightClass = '';\n        if (item && i === item.seriesIndex) {\n          highlightClass = 'graph-tooltip-list-item--highlight';\n        }\n\n        series = seriesList[i];\n\n        value = series.formatValue(hoverInfo.value);\n\n        seriesHtml += '<div class=\"graph-tooltip-list-item ' + highlightClass + '\"><div class=\"graph-tooltip-series-name\">';\n        seriesHtml += '<i class=\"fa fa-minus\" style=\"color:' + series.color +';\"></i> ' + series.label + ':</div>';\n        seriesHtml += '<div class=\"graph-tooltip-value\">' + value + '</div></div>';\n        plot.highlight(i, hoverInfo.hoverIndex);\n      }\n\n      self.showTooltip(seriesHoverInfo.time, seriesHtml, pos);\n    }\n    // single series tooltip\n    else if (item) {\n      series = seriesList[item.seriesIndex];\n      group = '<div class=\"graph-tooltip-list-item\"><div class=\"graph-tooltip-series-name\">';\n      group += '<i class=\"fa fa-minus\" style=\"color:' + item.series.color +';\"></i> ' + series.label + ':</div>';\n\n      if (panel.stack && panel.tooltip.value_type === 'individual') {\n        value = item.datapoint[1] - item.datapoint[2];\n      }\n      else {\n        value = item.datapoint[1];\n      }\n\n      value = series.formatValue(value);\n\n      group += '<div class=\"graph-tooltip-value\">' + value + '</div>';\n\n      self.showTooltip(item.datapoint[0], group, pos);\n    }\n    // no hit\n    else {\n      $tooltip.detach();\n    }\n  });\n}\n"]}