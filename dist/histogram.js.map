{"version":3,"sources":["../src/histogram.js"],"names":["angular","$","moment","_","kbn","HistogramTooltip","module","directive","$rootScope","timeSrv","restrict","template","link","scope","elem","ctrl","dashboard","panel","data","annotations","sortedSeries","legendSideLastValue","rootScope","$root","onAppEvent","event","info","sharedCrosshair","plot","setCrosshair","x","pos","y","clearCrosshair","events","on","renderData","refresh","render_panel","getLegendHeight","panelHeight","legend","show","rightSide","alignAsTable","legendSeries","filter","series","hideFromLegend","total","length","Math","min","floor","setElementHeight","height","css","e","console","log","shouldAbortRender","isString","render_panel_as_graphite_png","width","drawHook","yaxis","getYAxes","i","axis","formater","valueFormats","yaxes","format","isNumber","decimals","updateLegendValues","tickDecimals","scaledDecimals","$$phase","$digest","label","yaxisLabel","text","appendTo","rightLabel","processOffsetHook","gridMargin","left","right","getHistogramPairs","fillStyle","bucketSize","minValue","maxValue","normalize","stats","max","Number","MIN_VALUE","MAX_VALUE","avg","current","ignoreNulls","nullAsZero","values","currentValue","filterMin","filterMax","isNaN","datapoints","bucket","result","sortBy","map","timeStep","count","reduce","memo","num","forEach","item","idx","val","push","stack","align","centeredbars","orderedbars","options","hooks","draw","processOffset","stackpercent","percentage","bars","fill","alphabars","parseFloat","barWidth","zero","lineWidth","shadowSize","xaxis","grid","minBorderMargin","markings","backgroundColor","borderWidth","hoverable","color","margin","selection","mode","crosshair","tooltip","shared","scopedVars","templateSrv","replaceWithText","toString","bucketMode","nullPointMode","hiddenSeries","alias","ordered","addHistogramAxis","zindex","order","callPlot","incrementRenderCounter","renderingCompleted","shouldDelayDraw","setTimeout","translateFillOption","ticks","autoticks","Array","cnt","applyLogScale","logBase","index","nextTick","transform","v","inverseTransform","pow","configureAxisMode","tickFormatter","time_format","range","secPerTick","oneDay","oneYear","url","replace","toFixed","linewidth","leftMin","leftMax","rightMin","rightMax","steppedLine","html","bind","ranges","$apply","setTime","from","utc","to"],"mappings":"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","file":"histogram.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport HistogramTooltip from './histogram_tooltip.js';\nimport 'jquery.flot';\nimport './flot/jquery.flot.orderBars';\nimport 'jquery.flot.selection';\nimport 'jquery.flot.time';\nimport 'jquery.flot.stack';\nimport 'jquery.flot.stackpercent';\nimport 'jquery.flot.fillbelow';\nimport 'jquery.flot.crosshair';\nimport 'app/plugins/panel/graph/jquery.flot.events';\n\nangular.module('grafana.directives').directive('grafanaHistogram', function($rootScope, timeSrv) {\n  return {\n    restrict: 'A',\n    template: '<div> </div>',\n    link: function(scope, elem) {\n      var ctrl = scope.ctrl;\n      var dashboard = ctrl.dashboard;\n      var panel = ctrl.panel;\n      var data, annotations;\n      var sortedSeries;\n      var legendSideLastValue = null;\n      var rootScope = scope.$root;\n\n      rootScope.onAppEvent('setCrosshair', function(event, info) {\n        // do not need to to this if event is from this panel\n        if (info.scope === scope) {\n          return;\n        }\n\n        if(dashboard.sharedCrosshair) {\n          var plot = elem.data().plot;\n          if (plot) {\n            plot.setCrosshair({ x: info.pos.x, y: info.pos.y });\n          }\n        }\n      }, scope);\n\n      rootScope.onAppEvent('clearCrosshair', function() {\n        var plot = elem.data().plot;\n        if (plot) {\n          plot.clearCrosshair();\n        }\n      }, scope);\n\n      // Receive render events\n      ctrl.events.on('render', function(renderData) {\n        data = renderData || data;\n        if (!data) {\n          ctrl.refresh();\n          return;\n        }\n        annotations = data.annotations || annotations;\n        render_panel();\n      });\n\n      function getLegendHeight(panelHeight) {\n        if (!panel.legend.show || panel.legend.rightSide) {\n          return 2;\n        }\n\n        if (panel.legend.alignAsTable) {\n          var legendSeries = _.filter(data, function(series) {\n            return series.hideFromLegend(panel.legend) === false;\n          });\n          var total = 23 + (22 * legendSeries.length);\n          return Math.min(total, Math.floor(panelHeight/2));\n        } else {\n          return 26;\n        }\n      }\n\n      function setElementHeight() {\n        try {\n          var height = ctrl.height - getLegendHeight(ctrl.height);\n          elem.css('height', height + 'px');\n\n          return true;\n        } catch(e) { // IE throws errors sometimes\n          console.log(e);\n          return false;\n        }\n      }\n\n      function shouldAbortRender() {\n        if (!data) {\n          return true;\n        }\n\n        if (!setElementHeight()) { return true; }\n\n        if(_.isString(data)) {\n          render_panel_as_graphite_png(data);\n          return true;\n        }\n\n        if (elem.width() === 0) {\n          return true;\n        }\n      }\n\n      function drawHook(plot) {\n        // Update legend values\n        var yaxis = plot.getYAxes();\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          var axis = yaxis[series.yaxis - 1];\n          var formater = kbn.valueFormats[panel.yaxes[series.yaxis - 1].format];\n\n          // decimal override\n          if (_.isNumber(panel.decimals)) {\n            series.updateLegendValues(formater, panel.decimals, null);\n          } else {\n            // auto decimals\n            // legend and tooltip gets one more decimal precision\n            // than graph legend ticks\n            var tickDecimals = (axis.tickDecimals || -1) + 1;\n            series.updateLegendValues(formater, tickDecimals, axis.scaledDecimals + 2);\n          }\n\n          if(!rootScope.$$phase) { scope.$digest(); }\n        }\n\n        // add left axis labels\n        if (panel.yaxes[0].label) {\n          var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\n            .text(panel.yaxes[0].label)\n            .appendTo(elem);\n\n          yaxisLabel.css(\"margin-top\", yaxisLabel.width() / 2);\n        }\n\n        // add right axis labels\n        if (panel.yaxes[1].label) {\n          var rightLabel = $(\"<div class='axisLabel right-yaxis-label'></div>\")\n            .text(panel.yaxes[1].label)\n            .appendTo(elem);\n\n          rightLabel.css(\"margin-top\", rightLabel.width() / 2);\n        }\n      }\n\n      function processOffsetHook(plot, gridMargin) {\n        var left = panel.yaxes[0];\n        var right = panel.yaxes[1];\n        if (left.show && left.label) { gridMargin.left = 20; }\n        if (right.show && right.label) { gridMargin.right = 20; }\n      }\n\n      function getHistogramPairs(series, fillStyle, bucketSize, minValue, maxValue, normalize) {\n        if (bucketSize === null || bucketSize <= 0) {\n          bucketSize = 1;\n        }\n\n        series.yaxis = 1; // TODO check\n        series.stats.total = 0;\n        series.stats.max = Number.MIN_VALUE;\n        series.stats.min = Number.MAX_VALUE;\n        series.stats.avg = null;\n        series.stats.current = null;\n        var ignoreNulls = fillStyle === 'connected' || fillStyle === 'null';\n        var nullAsZero = fillStyle === 'null as zero';\n        var values = {};\n        var currentValue;\n        var filterMin = false;\n        var filterMax = false;\n        if (_.isNumber(minValue) && !isNaN(minValue)) {\n          values[minValue] = [minValue, 0];\n          filterMin = true;\n        }\n        if (_.isNumber(maxValue) && !isNaN(maxValue)) {\n          values[maxValue] = [maxValue, 0];\n          filterMax = true;\n        }\n        for (var i = 0; i < series.datapoints.length; i++) {\n          currentValue = series.datapoints[i][0];\n          if (currentValue === null) {\n            if (ignoreNulls) { continue; }\n            if (nullAsZero) {\n              currentValue = 0;\n            }\n          }\n          if (_.isNumber(currentValue)) {\n            series.stats.total += currentValue;\n          }\n          if (currentValue > series.stats.max) {\n            series.stats.max = currentValue;\n          }\n          if (currentValue < series.stats.min) {\n            series.stats.min = currentValue;\n          }\n          if(filterMin && currentValue < minValue) continue;\n          if(filterMax && currentValue > maxValue) continue;\n\n          var bucket = Math.floor(currentValue / bucketSize) * bucketSize;\n          if (bucket in values) {\n            values[bucket][1]++;\n          } else {\n            values[bucket] = [bucket, 1];\n          }\n        }\n\n        var result = _.sortBy(values, x => x[0]);\n        if (normalize) {\n          result = _.map(values, x => {\n            return [x[0], x[1] / series.stats.total];\n          });\n        }\n        series.stats.timeStep = bucketSize;\n        if (series.stats.max === Number.MIN_VALUE) { series.stats.max = null; }\n        if (series.stats.min === Number.MAX_VALUE) { series.stats.min = null; }\n        if (result.length) {\n          var count = _.reduce(_.values(values), function(memo, num) { return memo + num; }, 0);\n          series.stats.avg = series.stats.total / count;\n          series.stats.current = currentValue;\n        }\n        series.stats.count = result.length;\n\n        result=[];\n        _.forEach(series.datapoints, function(item) {\n            var idx = result.length;\n            var val = {\n            }\n            result.push([idx, item[0]]);\n        });\n        series.stats.count = result.length;\n\n        return result;\n      }\n\n      // Function for rendering panel\n      function render_panel() {\n        if (shouldAbortRender()) {\n          return;\n        }\n\n        var stack = panel.stack ? true : null;\n        var align = panel.centeredbars ? \"center\" : \"left\";\n        if (panel.orderedbars) {\n            align = \"left\";\n        }\n\n        // Populate element\n        var options = {\n          hooks: {\n            draw: [drawHook],\n            processOffset: [processOffsetHook],\n          },\n          legend: { show: false },\n          series: {\n            stackpercent: panel.stack ? panel.percentage : false,\n            stack: panel.percentage ? null : stack,\n            bars:   {\n              show: true,\n              fill: panel.alphabars ? parseFloat(panel.alphabars, 10) : 1,\n              barWidth: 1,\n              zero: false,\n              lineWidth: 1,\n              align: align\n            },\n            shadowSize: 1\n          },\n          yaxes: [],\n          xaxis: {},\n          grid: {\n            minBorderMargin: 0,\n            markings: [],\n            backgroundColor: null,\n            borderWidth: 0,\n            hoverable: true,\n            color: '#c8c8c8',\n            margin: { left: 0, right: 0 },\n          },\n          selection: {\n            mode: \"x\",\n            color: '#666'\n          },\n          crosshair: {\n            mode: panel.tooltip.shared || dashboard.sharedCrosshair ? \"x\" : null\n          }\n        };\n\n        var scopedVars = ctrl.panel.scopedVars;\n        var bucketSize = !panel.bucketSize && panel.bucketSize !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.bucketSize.toString(), scopedVars));\n        var minValue = !panel.minValue && panel.minValue !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.minValue.toString(), scopedVars));\n        var maxValue = !panel.maxValue && panel.maxValue !== 0 ? null : parseFloat(ctrl.templateSrv.replaceWithText(panel.maxValue.toString(), scopedVars));\n\n        switch(panel.bucketMode) {\n          case 'count':\n            bucketSize = (maxValue - minValue) / bucketSize;\n            break;\n        }\n\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          series.data = getHistogramPairs(series, series.nullPointMode || panel.nullPointMode, bucketSize || 1, minValue, maxValue, panel.normalize);\n\n          // if hidden remove points and disable stack\n          if (ctrl.hiddenSeries[series.alias]) {\n            series.data = [];\n            series.stack = false;\n          }\n        }\n\n        /*\n        if (data.length && data[0].stats.timeStep) {\n          options.series.bars.barWidth = data[0].stats.timeStep / 1.5;\n        }\n        */\n        if (data.length) {\n            if (panel.ordered) {\n                options.series.bars.barWidth = (1 / data.length) - 0.05;\n            } else {\n                options.series.bars.barWidth = 0.9;\n            }\n        }\n\n        addHistogramAxis(options);\n        options.selection = {};\n\n        sortedSeries = _.sortBy(data, function(series) { return series.zindex; });\n\n        if (panel.ordered) {\n            var order = 0;\n            _.forEach(sortedSeries, function(item) {\n                item.bars.order = order++;\n            });\n        }\n\n        function callPlot(incrementRenderCounter) {\n          try {\n            $.plot(elem, sortedSeries, options);\n          } catch (e) {\n            console.log('flotcharts error', e);\n          }\n\n          if (incrementRenderCounter) {\n            ctrl.renderingCompleted();\n          }\n        }\n\n        if (shouldDelayDraw(panel)) {\n          // temp fix for legends on the side, need to render twice to get dimensions right\n          callPlot(false);\n          setTimeout(function() { callPlot(true); }, 50);\n          legendSideLastValue = panel.legend.rightSide;\n        }\n        else {\n          callPlot(true);\n        }\n      }\n\n      function translateFillOption(fill) {\n        return fill === 0 ? 0.001 : fill/10;\n      }\n\n      function shouldDelayDraw(panel) {\n        if (panel.legend.rightSide) {\n          return true;\n        }\n        if (legendSideLastValue !== null && panel.legend.rightSide !== legendSideLastValue) {\n          return true;\n        }\n      }\n\n      function addHistogramAxis(options) {\n       var ticks;\n       if(panel.autoticks) {\n        ticks = elem.width() / 100;\n       } else {\n        var ticks = Array();\n        if(data.length) {\n            var cnt = 0;\n            _.forEach(data[0].datapoints, function(item) {\n                ticks.push([data[0].data[cnt][0], item[1]]);\n                cnt++;\n            });\n        }\n       }\n       options.xaxis = {\n        show: panel['x-axis'],\n        label: \"Values\",\n        ticks: ticks\n       };\n      }\n\n      function applyLogScale(axis, data) {\n        if (axis.logBase === 1) {\n          return;\n        }\n\n        var series, i;\n        var max = axis.max;\n\n        if (max === null) {\n          for (i = 0; i < data.length; i++) {\n            series = data[i];\n            if (series.yaxis === axis.index) {\n              if (max < series.stats.max) {\n                max = series.stats.max;\n              }\n            }\n          }\n          if (max === void 0) {\n            max = Number.MAX_VALUE;\n          }\n        }\n\n        axis.min = axis.min !== null ? axis.min : 0;\n        axis.ticks = [0, 1];\n        var nextTick = 1;\n\n        while (true) {\n          nextTick = nextTick * axis.logBase;\n          axis.ticks.push(nextTick);\n          if (nextTick > max) {\n            break;\n          }\n        }\n\n        if (axis.logBase === 10) {\n          axis.transform = function(v) { return Math.log(v+0.1); };\n          axis.inverseTransform  = function (v) { return Math.pow(10,v); };\n        } else {\n          axis.transform = function(v) { return Math.log(v+0.1) / Math.log(axis.logBase); };\n          axis.inverseTransform  = function (v) { return Math.pow(axis.logBase,v); };\n        }\n      }\n\n      function configureAxisMode(axis, format) {\n        axis.tickFormatter = function(val, axis) {\n          return kbn.valueFormats[format](val, axis.tickDecimals, axis.scaledDecimals);\n        };\n      }\n\n      function time_format(ticks, min, max) {\n        if (min && max && ticks) {\n          var range = max - min;\n          var secPerTick = (range/ticks) / 1000;\n          var oneDay = 86400000;\n          var oneYear = 31536000000;\n\n          if (secPerTick <= 45) {\n            return \"%H:%M:%S\";\n          }\n          if (secPerTick <= 7200 || range <= oneDay) {\n            return \"%H:%M\";\n          }\n          if (secPerTick <= 80000) {\n            return \"%m/%d %H:%M\";\n          }\n          if (secPerTick <= 2419200 || range <= oneYear) {\n            return \"%m/%d\";\n          }\n          return \"%Y-%m\";\n        }\n\n        return \"%H:%M\";\n      }\n\n      function render_panel_as_graphite_png(url) {\n        url += '&width=' + elem.width();\n        url += '&height=' + elem.css('height').replace('px', '');\n        url += '&bgcolor=1f1f1f'; // @grayDarker & @grafanaPanelBackground\n        url += '&fgcolor=BBBFC2'; // @textColor & @grayLighter\n        url += panel.stack ? '&areaMode=stacked' : '';\n        url += panel.fill !== 0 ? ('&areaAlpha=' + (panel.fill/10).toFixed(1)) : '';\n        url += panel.linewidth !== 0 ? '&lineWidth=' + panel.linewidth : '';\n        url += panel.legend.show ? '&hideLegend=false' : '&hideLegend=true';\n        url += panel.grid.leftMin !== null ? '&yMin=' + panel.grid.leftMin : '';\n        url += panel.grid.leftMax !== null ? '&yMax=' + panel.grid.leftMax : '';\n        url += panel.grid.rightMin !== null ? '&yMin=' + panel.grid.rightMin : '';\n        url += panel.grid.rightMax !== null ? '&yMax=' + panel.grid.rightMax : '';\n        url += panel['x-axis'] ? '' : '&hideAxes=true';\n        url += panel['y-axis'] ? '' : '&hideYAxis=true';\n\n        switch(panel.yaxes[0].format) {\n          case 'bytes':\n            url += '&yUnitSystem=binary';\n            break;\n          case 'bits':\n            url += '&yUnitSystem=binary';\n            break;\n          case 'bps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'pps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'Bps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'short':\n            url += '&yUnitSystem=si';\n            break;\n          case 'joule':\n            url += '&yUnitSystem=si';\n            break;\n          case 'watt':\n            url += '&yUnitSystem=si';\n            break;\n          case 'ev':\n            url += '&yUnitSystem=si';\n            break;\n          case 'none':\n            url += '&yUnitSystem=none';\n            break;\n        }\n\n        switch(panel.nullPointMode) {\n          case 'connected':\n            url += '&lineMode=connected';\n            break;\n          case 'null':\n            break; // graphite default lineMode\n          case 'null as zero':\n            url += \"&drawNullAsZero=true\";\n            break;\n        }\n\n        url += panel.steppedLine ? '&lineMode=staircase' : '';\n\n        elem.html('<img src=\"' + url + '\"></img>');\n      }\n\n      new HistogramTooltip(elem, dashboard, scope, function() {\n        return sortedSeries;\n      });\n\n      elem.bind(\"plotselected\", function (event, ranges) {\n        scope.$apply(function() {\n          timeSrv.setTime({\n            from  : moment.utc(ranges.xaxis.from),\n            to    : moment.utc(ranges.xaxis.to),\n          });\n        });\n      });\n    }\n  };\n});\n"]}