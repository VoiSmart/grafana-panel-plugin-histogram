{"version":3,"sources":["../src/histogram.js"],"names":[],"mappings":"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","file":"histogram.js","sourcesContent":["import angular from 'angular';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport HistogramTooltip from './histogram_tooltip.js';\nimport 'jquery.flot';\nimport './flot/jquery.flot.orderBars';\nimport 'jquery.flot.selection';\nimport 'jquery.flot.time';\nimport 'jquery.flot.stack';\nimport 'jquery.flot.stackpercent';\nimport 'jquery.flot.fillbelow';\nimport 'jquery.flot.crosshair';\nimport 'app/plugins/panel/graph/jquery.flot.events';\n\nangular.module('grafana.directives').directive('grafanaHistogram', function($rootScope, timeSrv) {\n  return {\n    restrict: 'A',\n    template: '<div> </div>',\n    link: function(scope, elem) {\n      var ctrl = scope.ctrl;\n      var dashboard = ctrl.dashboard;\n      var panel = ctrl.panel;\n      var data, annotations;\n      var sortedSeries;\n      var legendSideLastValue = null;\n      var rootScope = scope.$root;\n\n      rootScope.onAppEvent('setCrosshair', function(event, info) {\n        // do not need to to this if event is from this panel\n        if (info.scope === scope) {\n          return;\n        }\n\n        if(dashboard.sharedCrosshair) {\n          var plot = elem.data().plot;\n          if (plot) {\n            plot.setCrosshair({ x: info.pos.x, y: info.pos.y });\n          }\n        }\n      }, scope);\n\n      rootScope.onAppEvent('clearCrosshair', function() {\n        var plot = elem.data().plot;\n        if (plot) {\n          plot.clearCrosshair();\n        }\n      }, scope);\n\n      // Receive render events\n      ctrl.events.on('render', function(renderData) {\n        data = renderData || data;\n        if (!data) {\n          ctrl.refresh();\n          return;\n        }\n        annotations = data.annotations || annotations;\n        render_panel();\n      });\n\n      function getLegendHeight(panelHeight) {\n        if (!panel.legend.show || panel.legend.rightSide) {\n          return 2;\n        }\n\n        if (panel.legend.alignAsTable) {\n          var legendSeries = _.filter(data, function(series) {\n            return series.hideFromLegend(panel.legend) === false;\n          });\n          var total = 23 + (22 * legendSeries.length);\n          return Math.min(total, Math.floor(panelHeight/2));\n        } else {\n          return 26;\n        }\n      }\n\n      function setElementHeight() {\n        try {\n          var height = ctrl.height - getLegendHeight(ctrl.height);\n          elem.css('height', height + 'px');\n\n          return true;\n        } catch(e) { // IE throws errors sometimes\n          console.log(e);\n          return false;\n        }\n      }\n\n      function shouldAbortRender() {\n        if (!data) {\n          return true;\n        }\n\n        if (!setElementHeight()) { return true; }\n\n        if(_.isString(data)) {\n          render_panel_as_graphite_png(data);\n          return true;\n        }\n\n        if (elem.width() === 0) {\n          return true;\n        }\n      }\n\n      function drawHook(plot) {\n        // Update legend values\n        var yaxis = plot.getYAxes();\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          var axis = yaxis[series.yaxis - 1];\n          var formater = kbn.valueFormats[panel.yaxes[series.yaxis - 1].format];\n\n          // decimal override\n          if (_.isNumber(panel.decimals)) {\n            series.updateLegendValues(formater, panel.decimals, null);\n          } else {\n            // auto decimals\n            // legend and tooltip gets one more decimal precision\n            // than graph legend ticks\n            var tickDecimals = (axis.tickDecimals || -1) + 1;\n            series.updateLegendValues(formater, tickDecimals, axis.scaledDecimals + 2);\n          }\n\n          if(!rootScope.$$phase) { scope.$digest(); }\n        }\n\n        // add left axis labels\n        if (panel.yaxes[0].label) {\n          var yaxisLabel = $(\"<div class='axisLabel left-yaxis-label'></div>\")\n            .text(panel.yaxes[0].label)\n            .appendTo(elem);\n\n          yaxisLabel.css(\"margin-top\", yaxisLabel.width() / 2);\n        }\n\n        // add right axis labels\n        if (panel.yaxes[1].label) {\n          var rightLabel = $(\"<div class='axisLabel right-yaxis-label'></div>\")\n            .text(panel.yaxes[1].label)\n            .appendTo(elem);\n\n          rightLabel.css(\"margin-top\", rightLabel.width() / 2);\n        }\n      }\n\n      function processOffsetHook(plot, gridMargin) {\n        var left = panel.yaxes[0];\n        var right = panel.yaxes[1];\n        if (left.show && left.label) { gridMargin.left = 20; }\n        if (right.show && right.label) { gridMargin.right = 20; }\n      }\n\n      function getHistogramPairs(series, fillStyle, bucketSize) {\n        var result = [];\n        if (bucketSize === null || bucketSize === 0) {\n          bucketSize = 1;\n        }\n        series.yaxis = 1; // TODO check\n        series.stats.total = 0;\n        series.stats.max = Number.MIN_VALUE;\n        series.stats.min = Number.MAX_VALUE;\n        series.stats.avg = null;\n        series.stats.current = null;\n        var ignoreNulls = fillStyle === 'connected' || fillStyle === 'null';\n        var nullAsZero = fillStyle === 'null as zero';\n        var values = {};\n        var currentValue;\n        for (var i = 0; i < series.datapoints.length; i++) {\n          currentValue = series.datapoints[i][0];\n          if (currentValue === null) {\n            if (ignoreNulls) { continue; }\n            if (nullAsZero) {\n              currentValue = 0;\n            }\n          }\n          if (_.isNumber(currentValue)) {\n            series.stats.total += currentValue;\n          }\n          if (currentValue > series.stats.max) {\n            series.stats.max = currentValue;\n          }\n          if (currentValue < series.stats.min) {\n            series.stats.min = currentValue;\n          }\n          var bucket = (Math.floor(currentValue / bucketSize)*bucketSize).toFixed(3);\n          if (bucket in values) {\n            values[bucket]++;\n          } else {\n            values[bucket] = 1;\n          }\n        }\n        _.forEach(Object.keys(values).sort(), function(key) {\n          result.push([key, values[key]]);\n        });\n        series.stats.timeStep = bucketSize;\n        if (series.stats.max === Number.MIN_VALUE) { series.stats.max = null; }\n        if (series.stats.min === Number.MAX_VALUE) { series.stats.min = null; }\n        if (result.length) {\n          series.stats.avg = (series.stats.total / result.length);\n          series.stats.current = currentValue;\n        }\n        series.stats.count = result.length;\n\n        result=[];\n        _.forEach(series.datapoints, function(item) {\n            var idx = result.length;\n            var val = {\n            }\n            result.push([idx, item[0]]);\n        });\n        series.stats.count = result.length;\n\n        return result;\n      }\n\n      // Function for rendering panel\n      function render_panel() {\n        if (shouldAbortRender()) {\n          return;\n        }\n\n        var stack = panel.stack ? true : null;\n        var align = panel.centeredbars ? \"center\" : \"left\";\n        if (panel.orderedbars) {\n            align = \"left\";\n        }\n\n        // Populate element\n        var options = {\n          hooks: {\n            draw: [drawHook],\n            processOffset: [processOffsetHook],\n          },\n          legend: { show: false },\n          series: {\n            stackpercent: panel.stack ? panel.percentage : false,\n            stack: panel.percentage ? null : stack,\n            bars:   {\n              show: true,\n              fill: panel.alphabars ? parseFloat(panel.alphabars, 10) : 1,\n              barWidth: 1,\n              zero: false,\n              lineWidth: 1,\n              align: align\n            },\n            shadowSize: 1\n          },\n          yaxes: [],\n          xaxis: {},\n          grid: {\n            minBorderMargin: 0,\n            markings: [],\n            backgroundColor: null,\n            borderWidth: 0,\n            hoverable: true,\n            color: '#c8c8c8',\n            margin: { left: 0, right: 0 },\n          },\n          selection: {\n            mode: \"x\",\n            color: '#666'\n          },\n          crosshair: {\n            mode: panel.tooltip.shared || dashboard.sharedCrosshair ? \"x\" : null\n          }\n        };\n\n        for (var i = 0; i < data.length; i++) {\n          var series = data[i];\n          series.data = getHistogramPairs(series, series.nullPointMode || panel.nullPointMode, panel.bucketSize || 1);\n\n          // if hidden remove points and disable stack\n          if (ctrl.hiddenSeries[series.alias]) {\n            series.data = [];\n            series.stack = false;\n          }\n        }\n\n        /*\n        if (data.length && data[0].stats.timeStep) {\n          options.series.bars.barWidth = data[0].stats.timeStep / 1.5;\n        }\n        */\n        if (data.length) {\n            if (panel.ordered) {\n                options.series.bars.barWidth = (1 / data.length) - 0.05;\n            } else {\n                options.series.bars.barWidth = 0.9;\n            }\n        }\n\n        addHistogramAxis(options);\n        options.selection = {};\n\n        sortedSeries = _.sortBy(data, function(series) { return series.zindex; });\n\n        if (panel.ordered) {\n            var order = 0;\n            _.forEach(sortedSeries, function(item) {\n                item.bars.order = order++;\n            });\n        }\n\n        function callPlot(incrementRenderCounter) {\n          try {\n            $.plot(elem, sortedSeries, options);\n          } catch (e) {\n            console.log('flotcharts error', e);\n          }\n\n          if (incrementRenderCounter) {\n            ctrl.renderingCompleted();\n          }\n        }\n\n        if (shouldDelayDraw(panel)) {\n          // temp fix for legends on the side, need to render twice to get dimensions right\n          callPlot(false);\n          setTimeout(function() { callPlot(true); }, 50);\n          legendSideLastValue = panel.legend.rightSide;\n        }\n        else {\n          callPlot(true);\n        }\n      }\n\n      function translateFillOption(fill) {\n        return fill === 0 ? 0.001 : fill/10;\n      }\n\n      function shouldDelayDraw(panel) {\n        if (panel.legend.rightSide) {\n          return true;\n        }\n        if (legendSideLastValue !== null && panel.legend.rightSide !== legendSideLastValue) {\n          return true;\n        }\n      }\n\n      function addHistogramAxis(options) {\n       var ticks;\n       if(panel.autoticks) {\n        ticks = elem.width() / 100;\n       } else {\n        var ticks = Array();\n        if(data.length) {\n            var cnt = 0;\n            _.forEach(data[0].datapoints, function(item) {\n                ticks.push([data[0].data[cnt][0], item[1]]);\n                cnt++;\n            });\n        }\n       }\n       options.xaxis = {\n        show: panel['x-axis'],\n        label: \"Values\",\n        ticks: ticks\n       };\n      }\n\n      function applyLogScale(axis, data) {\n        if (axis.logBase === 1) {\n          return;\n        }\n\n        var series, i;\n        var max = axis.max;\n\n        if (max === null) {\n          for (i = 0; i < data.length; i++) {\n            series = data[i];\n            if (series.yaxis === axis.index) {\n              if (max < series.stats.max) {\n                max = series.stats.max;\n              }\n            }\n          }\n          if (max === void 0) {\n            max = Number.MAX_VALUE;\n          }\n        }\n\n        axis.min = axis.min !== null ? axis.min : 0;\n        axis.ticks = [0, 1];\n        var nextTick = 1;\n\n        while (true) {\n          nextTick = nextTick * axis.logBase;\n          axis.ticks.push(nextTick);\n          if (nextTick > max) {\n            break;\n          }\n        }\n\n        if (axis.logBase === 10) {\n          axis.transform = function(v) { return Math.log(v+0.1); };\n          axis.inverseTransform  = function (v) { return Math.pow(10,v); };\n        } else {\n          axis.transform = function(v) { return Math.log(v+0.1) / Math.log(axis.logBase); };\n          axis.inverseTransform  = function (v) { return Math.pow(axis.logBase,v); };\n        }\n      }\n\n      function configureAxisMode(axis, format) {\n        axis.tickFormatter = function(val, axis) {\n          return kbn.valueFormats[format](val, axis.tickDecimals, axis.scaledDecimals);\n        };\n      }\n\n      function time_format(ticks, min, max) {\n        if (min && max && ticks) {\n          var range = max - min;\n          var secPerTick = (range/ticks) / 1000;\n          var oneDay = 86400000;\n          var oneYear = 31536000000;\n\n          if (secPerTick <= 45) {\n            return \"%H:%M:%S\";\n          }\n          if (secPerTick <= 7200 || range <= oneDay) {\n            return \"%H:%M\";\n          }\n          if (secPerTick <= 80000) {\n            return \"%m/%d %H:%M\";\n          }\n          if (secPerTick <= 2419200 || range <= oneYear) {\n            return \"%m/%d\";\n          }\n          return \"%Y-%m\";\n        }\n\n        return \"%H:%M\";\n      }\n\n      function render_panel_as_graphite_png(url) {\n        url += '&width=' + elem.width();\n        url += '&height=' + elem.css('height').replace('px', '');\n        url += '&bgcolor=1f1f1f'; // @grayDarker & @grafanaPanelBackground\n        url += '&fgcolor=BBBFC2'; // @textColor & @grayLighter\n        url += panel.stack ? '&areaMode=stacked' : '';\n        url += panel.fill !== 0 ? ('&areaAlpha=' + (panel.fill/10).toFixed(1)) : '';\n        url += panel.linewidth !== 0 ? '&lineWidth=' + panel.linewidth : '';\n        url += panel.legend.show ? '&hideLegend=false' : '&hideLegend=true';\n        url += panel.grid.leftMin !== null ? '&yMin=' + panel.grid.leftMin : '';\n        url += panel.grid.leftMax !== null ? '&yMax=' + panel.grid.leftMax : '';\n        url += panel.grid.rightMin !== null ? '&yMin=' + panel.grid.rightMin : '';\n        url += panel.grid.rightMax !== null ? '&yMax=' + panel.grid.rightMax : '';\n        url += panel['x-axis'] ? '' : '&hideAxes=true';\n        url += panel['y-axis'] ? '' : '&hideYAxis=true';\n\n        switch(panel.yaxes[0].format) {\n          case 'bytes':\n            url += '&yUnitSystem=binary';\n            break;\n          case 'bits':\n            url += '&yUnitSystem=binary';\n            break;\n          case 'bps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'pps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'Bps':\n            url += '&yUnitSystem=si';\n            break;\n          case 'short':\n            url += '&yUnitSystem=si';\n            break;\n          case 'joule':\n            url += '&yUnitSystem=si';\n            break;\n          case 'watt':\n            url += '&yUnitSystem=si';\n            break;\n          case 'ev':\n            url += '&yUnitSystem=si';\n            break;\n          case 'none':\n            url += '&yUnitSystem=none';\n            break;\n        }\n\n        switch(panel.nullPointMode) {\n          case 'connected':\n            url += '&lineMode=connected';\n            break;\n          case 'null':\n            break; // graphite default lineMode\n          case 'null as zero':\n            url += \"&drawNullAsZero=true\";\n            break;\n        }\n\n        url += panel.steppedLine ? '&lineMode=staircase' : '';\n\n        elem.html('<img src=\"' + url + '\"></img>');\n      }\n\n      new HistogramTooltip(elem, dashboard, scope, function() {\n        return sortedSeries;\n      });\n\n      elem.bind(\"plotselected\", function (event, ranges) {\n        scope.$apply(function() {\n          timeSrv.setTime({\n            from  : moment.utc(ranges.xaxis.from),\n            to    : moment.utc(ranges.xaxis.to),\n          });\n        });\n      });\n    }\n  };\n});\n"]}